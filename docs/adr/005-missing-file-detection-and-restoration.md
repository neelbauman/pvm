# 5. Missing File Detection and Restoration

Date: 2026-02-04
Status: Accepted

## Context
`pvm` は Git の管理外でファイルを扱うため、ユーザーが誤ってファイルを削除したり、ディレクトリごと消してしまった場合、Git では復元できない「穴」が存在する。
以前の実装では、単にファイルをコピーするだけの `checkout` だったため、親ディレクトリが存在しない場合にエラーとなり、復元手順が煩雑だった。

## Decision
ファイルの欠損検知と堅牢な復元機能を実装する：

1. **Status Aware**: `pvm list` コマンドは、メタデータ上の記録と実際のファイルシステムを照合し、`Active` (存在) / `Missing` (欠損) のステータスを表示する。
2. **Robust Restore**: `pvm checkout` コマンドは、対象ファイルの親ディレクトリが存在しない場合、再帰的にディレクトリを作成した上でファイルを復元する。

## Consequences
### Positive
* ユーザーは誤削除を恐れずに試行錯誤できるようになり、ツールとしての信頼性（Reliability）が向上する。
* ディレクトリ構成を変更するようなリファクタリング時にも履歴を活用しやすくなる。

### Negative
* `list` コマンド実行時にファイルシステムへのアクセスが発生するため、大量のファイルを管理している場合に若干のパフォーマンスコストがかかる。
